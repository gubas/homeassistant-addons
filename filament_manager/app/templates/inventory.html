{% extends "base.html" %}

{% block content %}

<div class="page-header">
    <h2>ğŸ“¦ Inventaire des Filaments</h2>
    <p class="subtitle">{{ filaments|length }} bobine(s) en stock</p>
</div>

{% if not filaments %}
<div class="empty-state">
    <div class="empty-icon">ğŸ¨</div>
    <h3>Aucun filament</h3>
    <p>Commencez par ajouter votre premier filament !</p>
    <a href="./add" class="btn-primary">â• Ajouter un filament</a>
</div>
{% else %}
<div class="filaments-grid">
    {% for fil in filaments %}
    <div class="filament-card {{ 'low-stock' if fil['is_low_stock'] else '' }}">
        <div class="filament-header">
            <div class="filament-color" style="background-color: {{ get_color_code(fil['color']) }}"></div>
            <div class="filament-info">
                <h3 class="filament-name">{{ fil['name'] }}</h3>
                <span class="filament-type-badge">{{ fil['type'] }}</span>
                <span class="filament-color-badge">{{ fil['color'] }}</span>
            </div>
        </div>

        <div class="filament-stock">
            <div class="stock-label">
                <span>Stock restant</span>
                <span class="stock-percentage">{{ fil['percentage'] }}%</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ fil['percentage'] }}%"></div>
            </div>
            <div class="stock-details">
                <span>{{ fil['formatted_current'] }} / {{ fil['formatted_initial'] }}</span>
            </div>
            {% if fil['is_low_stock'] %}
            <div class="low-stock-warning">âš ï¸ Stock faible</div>
            {% endif %}
        </div>

        <div class="filament-cost">
            <span class="cost-label">CoÃ»t total:</span>
            <span class="cost-value">{{ fil['formatted_cost'] }}</span>
        </div>

        {% if fil.get('notes') %}
        <div class="filament-notes">
            ğŸ“ {{ fil['notes'] }}
        </div>
        {% endif %}

        <div class="filament-actions">
            <a href="./edit/{{ fil['id'] }}" class="btn-secondary">âœï¸ Ã‰diter</a>
            <button onclick="consumeFilament({{ fil['id'] }}, '{{ fil['name'] }}')" class="btn-secondary">ğŸ“‰
                Consommer</button>
            <button onclick="deleteFilament({{ fil['id'] }}, '{{ fil['name'] }}')" class="btn-danger">ğŸ—‘ï¸</button>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Modal pour consommation -->
<div id="consumeModal" class="modal">
    <div class="modal-content">
        <h3>ğŸ“‰ Enregistrer une consommation</h3>
        <form id="consumeForm">
            <input type="hidden" id="consumeFilamentId">
            <div class="form-group">
                <label>Filament:</label>
                <input type="text" id="consumeFilamentName" readonly>
            </div>
            <div class="form-group">
                <label for="consumeWeight">Poids utilisÃ© ({{ weight_unit }}):</label>
                <input type="number" id="consumeWeight" min="0" step="0.1" required>
            </div>
            <div class="form-group">
                <label for="consumePrintName">Nom de l'impression (optionnel):</label>
                <input type="text" id="consumePrintName">
            </div>
            <div class="modal-actions">
                <button type="submit" class="btn-primary">Enregistrer</button>
                <button type="button" onclick="closeModal()" class="btn-secondary">Annuler</button>
            </div>
        </form>
    </div>
</div>

{% endblock %}